[env]
_.path = ["./scripts"]
_.file = ".env"

[tools]
bun = "latest"
chezmoi = "latest"
"npm:@openai/codex" = "latest"
"npm:@playwright/cli" = "latest"
"npm:aws-cdk" = "latest"
wrangler = "latest"

[tasks.dev]
description = "Start development server"
run = "bunx turbo run dev"

[tasks.preview]
description = "Build and preview production build"
run = "bunx turbo run preview"

[tasks."test:unit"]
description = "Run unit tests"
run = "bunx turbo run test"

[tasks."test:e2e"]
run = ["./scripts/setup-e2e-d1.sh", "bun run test:e2e"]
description = "Run Playwright e2e tests"

[tasks."test:integration"]
description = "Run integration tests"
run = "bun run test:integration"

[tasks.lint]
description = "Run linting"
run = ["check-dep-rules.sh", "bunx turbo run lint"]

[tasks.typecheck]
description = "Run type checking with tsgo"
run = "bunx turbo run typecheck"

[tasks.format]
description = "Format code with oxfmt"
run = "bunx oxfmt ."

[tasks."format:check"]
description = "Check formatting with oxfmt"
run = "bunx oxfmt --check ."

[tasks."db:generate"]
description = "Generate Drizzle migrations"
run = "bunx drizzle-kit generate --config packages/platform/db/d1/drizzle.config.ts"

[tasks."db:migrate"]
description = "Apply local D1 migrations"
run = "./scripts/db-migrate.sh"

[tasks."db:seed"]
description = "Seed local D1 data"
run = "./scripts/db-seed.sh"
