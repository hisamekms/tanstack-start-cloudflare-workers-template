---
id: 7
tags: [security, lib, server-di, dependency-injection]
title: "@lib/server-diセキュリティレビュー — 問題なし"
created_at: 2026-03-01T00:00:00+09:00
updated_at: 2026-03-01T00:00:00+09:00
related_to: []
---

# @lib/server-diセキュリティレビュー — 問題なし

## 背景

`@lib/server-di` は純粋な TypeScript 製の DI（依存性注入）コンテナライブラリ。Token ベースのサービス登録・解決、3種類のライフタイム管理（singleton / transient / scoped）、階層的コンテナをサポートする。外部ランタイム依存なし。

## レビュー結果

### 問題なし（修正不要）

| チェック項目               | 結果                                                                                                                           |
| -------------------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| **入力バリデーション**     | `token()` の `description` は任意文字列だが、エラーメッセージ組み立てにのみ使用。サーバーサイドライブラリのため XSS リスクなし |
| **認証・認可**             | DI コンテナ自体は認証・認可を扱わない。該当なし                                                                                |
| **インジェクション脆弱性** | DB アクセス・シェル呼び出し・HTML 出力なし。`Map` ベースのストレージでプロトタイプ汚染リスクなし                               |
| **機密情報の取り扱い**     | `TokenNotRegisteredError` のメッセージに `token.description` を含むが、開発者定義の識別子であり機密情報ではない。ログ出力なし  |
| **依存パッケージ**         | ランタイム依存なし（devDependencies のみ: vitest, oxlint, tsconfig）。サプライチェーンリスクなし                               |
| **OWASP Top 10**           | 純粋なインメモリ DI コンテナのため該当するリスクなし                                                                           |

### 記録のみ（修正不要）

- **Singleton/Scoped キャッシュの `undefined` チェック**: `resolveSingleton` / `resolveScoped` で `cached !== undefined` を使用。`undefined` を正当な値として登録した場合、キャッシュヒットせず毎回 factory が再実行される。セキュリティリスクではないが、`undefined` をサービスとして登録するユースケースは想定されないため問題なし
- **Container の可変性**: `registerValue` / `registerFactory` は public メソッドで、コンテナ構築後も登録追加が可能。凍結（freeze）機能はないが、DI コンテナの標準的な設計であり、利用側の責務として許容

## 知見

### 純粋なユーティリティライブラリのセキュリティ特性

外部I/Oを持たない純粋な TypeScript ユーティリティライブラリは、攻撃対象面（attack surface）が極めて小さい。レビューの焦点は以下に絞られる:

- **プロトタイプ汚染**: オブジェクトリテラルや `Object.assign` の代わりに `Map` を使うことで回避できる
- **エラーメッセージへの情報漏洩**: 内部識別子のみを含み、ユーザー提供データや機密情報を含まないことを確認
- **依存パッケージ**: ランタイム依存がゼロであれば、サプライチェーンリスクは実質的にない
